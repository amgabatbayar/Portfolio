<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio SQL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            text-align: center;
        }
        header {
            background-color: #333;
            color: white;
            padding: 20px;
            font-size: 24px;
        }
        .container {
            width: 80%;
            margin: auto;
            padding: 20px;
        }
        .sql-project {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
        }
        .code-box {
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .code-header {
            background: #333;
            color: white;
            padding: 10px;
            cursor: pointer;
            text-align: left;
        }
        .code-content {
            display: none;
            padding: 10px;
            background: #272822;
            color: #fff;
            overflow-x: auto;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .result-table, th, td {
            border: 1px solid black;
            padding: 8px;
        }
        th {
            background-color: #333;
            color: white;
        }
    </style>
</head>
<body>
    <header>Portfolio SQL</header>
    <div class="container">
        <div class="sql-project">
            <h2>Projekt 1: Supermarket Sales </h2>
            <p><strong>Link:</strong> https://www.kaggle.com/code/fareedalianwar/supermarket-sales</p>
            
            <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Wczytanie danych</div>
                <pre class="code-content">
CREATE TEMPORARY TABLE tmp_main(
    Invoice_id TEXT,
    Branch TEXT,
    City TEXT,
    Customer_type TEXT,
    Gender TEXT,
    Product_line TEXT,
    Unit_price TEXT,
    Quantity TEXT,
    Tax5 TEXT,
    Total TEXT,
    Date TEXT,
    Time TEXT,
    Payment TEXT,
    cogs TEXT,
    gross_margin_percent TEXT,
    gross_income TEXT,
    Rating TEXT
);

COPY tmp_main FROM 'C:\Users\marcb\Desktop\archive\supermarket_sales.csv' DELIMITER ',' CSV HEADER;

CREATE TABLE main (
    Inv_id text,
    Branch TEXT,
    City TEXT,
    Custtype TEXT,
    Gender TEXT,
    Prod_line TEXT,
    Unit_price float,
    Quantity smallint,
    Tax5 float,
    Total float,
    trans_date DATE,
    Time TIME,
    Payment TEXT,
    cogs FLOAT,
    gross_margin_percent FLOAT,
    gross_income FLOAT,
    Rating FLOAT
);

INSERT INTO main(
    Inv_id,
    Branch,
    City,
    Custtype,
    Gender,
    Prod_line,
    Unit_price,
    Quantity,
    Tax5,
    Total,
    trans_date,
    Time,
    Payment,
    cogs,
    gross_margin_percent,
    gross_income,
    Rating
)
SELECT
    Invoice_id,
    Branch,
    City,
    Customer_type,
    Gender,
    Product_line,
    Unit_price::FLOAT,
    Quantity::SMALLINT,
    Tax5::FLOAT,
    Total::FLOAT,
    TO_DATE(Date, 'MM-DD-YYYY'),
    Time::TIME,
    Payment,
    cogs::FLOAT,
    gross_margin_percent::FLOAT,
    gross_income::FLOAT,
    Rating::FLOAT

                </pre>
                </div>
            <h2>Analiza sprzedaży</h2>
            <p><strong>Zastosowano:</strong> CTE, GROUP BY, podstawowe funkcje agregujące</p>
            
                <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Kod</div>
                <pre class="code-content">
----- Analiza sprzedaży

<p>1.Jaka jest średnia wartość transakcji dla każdego oddziału?</p>
                    
        SELECT Branch, avg(total) AS srednia
        from main
        GROUP BY Branch;

<p>2.  Która linia produktów (Product_line) generuje największy przychód?</p>
                    
SELECT Prod_line, sum(Total) AS total
FROM main
GROUP BY Prod_line
ORDER BY total DESC;

<p>3. Jakie jest 5 najlepiej sprzedających się produktów pod względem liczby sprzedanych sztuk?</p>

SELECT Prod_line,
       SUM(Quantity) as ile
FROM main
GROUP BY Prod_line
ORDER BY ile DESC
LIMIT 5;

<p>3.  Jakie są miesięczne przychody z podziałem na oddziały i miasta</p>
                    
WITH CTE AS (
SELECT EXTRACT(MONTH from trans_date) as miesiac,
       City,
       Branch,
       Total
FROM main
)
SELECT City,
       Branch,
       miesiac,
       ROUND(SUM(Total)::NUMERIC,2) as wartosc
FROM CTE
GROUP BY Branch, city, miesiac
ORDER BY city, Branch, miesiac

<p>4. Jakie są najpopularniejsze metody płatności?</p>
                    
SELECT Payment,
       count(*) AS ile
FROM main
GROUP BY Payment
                    
<p>5. Jaki jest średni koszt własny sprzedaży dla każdej linii produktów?</p>
                    
SELECT Prod_line,
       ROUND(AVG(cogs)::NUMERIC,2) AS sredni_koszt
FROM main
GROUP BY Prod_line
                </pre>
            </div>
            
                <h2>Analiza klientów</h2>
                <p><strong>Zastosowano:</strong> Funkcje okienkowe, CTE, GROUP BY, podstawowe funkcje agregujące</p>
                <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Kod</div>
                <pre class="code-content">
<p>1.  Jaki procent klientów stanowią kobiety i mężczyźni w każdym oddziale?</p>
                    
WITH cte as (
    SELECT Gender,
           COUNT(*) as ile
           FROM main
    GROUP BY Gender
)
SELECT Gender,
       ile,
       (ile * 100)/ SUM(ile) OVER ()
from cte
                    
<p>2. Jak różnią się średnie wydatki klientów w zależności od ich typu (Customer_type)?</p>

with cte AS (
SELECT Custtype,
       avg(total) AS srednia
FROM main
GROUP BY Custtype
)
SELECT Custtype,
       srednia,
       srednia / SUM(srednia) OVER() as procent
FROM cte

<p>3. Czy istnieje zależność między płcią klienta a wybraną metodą płatności?</p>
                    
WITH cte as (
    SELECT Gender,
           Payment,
           count(Payment) AS ile
    FROM main
    GROUP BY Gender, Payment
)
SELECT Gender,
       Payment,
       ile,
       ile / SUM(ile) OVER() AS obie,
       ile / SUM(ile) OVER(partition by Gender) AS jedna_plec
FROM cte

                </pre>
                </div>

                <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Wczytanie danych</div>
                <pre class="code-content">
SELECT product_name, SUM(quantity) AS total_sold 
FROM sales 
GROUP BY product_name 
ORDER BY total_sold DESC;
                </pre>
                </div>

                <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Wczytanie danych</div>
                <pre class="code-content">
SELECT product_name, SUM(quantity) AS total_sold 
FROM sales 
GROUP BY product_name 
ORDER BY total_sold DESC;
                </pre>
                </div>

                <div class="code-box">
                <div class="code-header" onclick="toggleCode(this)">▶ Wczytanie danych</div>
                <pre class="code-content">
SELECT product_name, SUM(quantity) AS total_sold 
FROM sales 
GROUP BY product_name 
ORDER BY total_sold DESC;
                </pre>
                </div>
            <h3>Wyniki:</h3>
            <table class="result-table">
                <tr>
                    <th>Produkt</th>
                    <th>Sprzedana Ilość</th>
                </tr>
                <tr>
                    <td>Telefon</td>
                    <td>120</td>
                </tr>
                <tr>
                    <td>Laptop</td>
                    <td>95</td>
                </tr>
            </table>
        </div>
    </div>
    
    <script>
        function toggleCode(header) {
            var content = header.nextElementSibling;
            if (content.style.display === "block") {
                content.style.display = "none";
                header.textContent = "▶ " + header.textContent.slice(2);
            } else {
                content.style.display = "block";
                header.textContent = "▼ " + header.textContent.slice(2);
            }
        }
    </script>
</body>
</html>
